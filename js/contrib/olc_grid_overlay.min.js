!function(t,e){"function"==typeof define&&define.amd?define(["b"],function(i){return t.returnExportsGlobal=e(i)}):"object"==typeof module&&module.exports?module.exports=e(require("b")):t.OLCGridOverlay=e()}(this,function(){function t(t){this._checkDefaultLabelStyle(),t=t||{},"undefined"!=typeof t.map&&this.setMap(map),this._minorGridDisplay=!0,"boolean"==typeof t.minorGridDisplay&&(this._minorGridDisplay=t.minorGridDisplay),this._roadmap={gridColor:"#7BAAF7",labelClass:"olc_overlay_text",majorOpacity:.75,minorOpacity:.2},this._satellite={gridColor:"#7BAAF7",labelClass:"olc_overlay_text",majorOpacity:.8,minorOpacity:.4},"string"==typeof t.roadMapColor&&(this._roadmap.gridColor=t.roadMapColor),"string"==typeof t.roadMapLabelClass&&(this._roadmap.labelClass=t.roadMapLabelClass),"string"==typeof t.satelliteMapColor&&(this._satellite.gridColor=t.satelliteMapColor),"string"==typeof t.satelliteMapLabelClass&&(this._satellite.labelClass=t.satelliteMapLabelClass),this._gridSettings=this._roadmap,this._gridLines=[],this._listeners=[],this._olcAlphabet="23456789CFGHJMPQRVWX",this._gridBounds={latLo:0,lngLo:0,latHi:0,lngHi:0},this._majorGridSizeDeg=0,this._majorGridZoomLevels=[{zoom:6,grid:20},{zoom:10,grid:1},{zoom:14,grid:.05},{zoom:32,grid:.0025}],this._labelFontSizes={cellLabelMinFontPx:16,cellLabelMaxFontPx:100,gridLabelMinFontPx:8,gridLabelMaxFontPx:24}}return t.prototype=new google.maps.OverlayView,t.prototype.onAdd=function(){function t(){s._clear(),s._draw()}function e(){s._clear()}function i(){s._clearLabels()}var s=this;this._draw(),this._listeners.push(google.maps.event.addListener(this.getMap(),"idle",t)),this._listeners.push(google.maps.event.addListener(this.getMap(),"maptypeid_changed",t)),this._listeners.push(google.maps.event.addListener(this.getMap(),"zoom_changed",e)),this._listeners.push(google.maps.event.addListener(this.getMap(),"dragstart",i))},t.prototype.draw=function(){},t.prototype.onRemove=function(){this._clear();for(var t=0;t<this._listeners.length;t++)google.maps.event.removeListener(this._listeners[t])},t.prototype.hide=function(){},t.prototype.show=function(){},t.prototype._checkDefaultLabelStyle=function(){for(var t=0;t<document.styleSheets.length;t++){var e=document.styleSheets[t].rules||document.styleSheets[t].cssRules;for(var i in e)if("string"==typeof e[i].selectorText&&".olc_overlay_text"===e[i].selectorText)return}var s=document.createElement("style");s.type="text/css",s.innerHTML=".olc_overlay_text {  font-family: Arial, sans;  color: #7BAAF7;  text-align: center;  position: fixed;  display: flex;  justify-content: center;  flex-direction: column; }",document.getElementsByTagName("head")[0].appendChild(s)},t.prototype._clear=function(){this._clearLines(),this._clearLabels()},t.prototype._clearLines=function(){try{for(var t=0;t<this._gridLines.length;t++)this._gridLines[t].setMap(null)}catch(e){}this._gridLines=[]},t.prototype._clearLabels=function(){this._clearMarkerLayer()},t.prototype._draw=function(){for(var t=0;t<this._majorGridZoomLevels.length;t++)if(this.getMap().getZoom()<=this._majorGridZoomLevels[t].zoom){this._majorGridSizeDeg=this._majorGridZoomLevels[t].grid;break}var e=this.getMap().getBounds(),i=e.getSouthWest(),s=e.getNorthEast();this._gridBounds.latLo=Math.floor((i.lat()+90)/this._majorGridSizeDeg)*this._majorGridSizeDeg-90,this._gridBounds.latLo=Math.max(this._gridBounds.latLo,-90),this._gridBounds.latHi=Math.ceil((s.lat()+90)/this._majorGridSizeDeg)*this._majorGridSizeDeg-90,this._gridBounds.latHi=Math.min(this._gridBounds.latHi,90),this._gridBounds.lngLo=Math.floor(i.lng()/this._majorGridSizeDeg)*this._majorGridSizeDeg,this._gridBounds.lngHi=Math.ceil(s.lng()/this._majorGridSizeDeg)*this._majorGridSizeDeg,this._gridBounds.lngLo>this._gridBounds.lngHi&&(this._gridBounds.lngHi=this._gridBounds.lngHi+360),this._gridSettings=this._roadmap;var a=this.getMap().getMapTypeId();(a===google.maps.MapTypeId.HYBRID||a===google.maps.MapTypeId.SATELLITE)&&(this._gridSettings=this._satellite),this._drawLines(this._majorGridSizeDeg,this._gridSettings.majorOpacity),this._labelOLCCells(),this.show(),!this._minorGridDisplay||Math.abs(this._llToPixels(this.getMap().getCenter().lat(),0).y-this._llToPixels(this.getMap().getCenter().lat()+this._majorGridSizeDeg/20,0).y)<10||(this._drawLines(this._majorGridSizeDeg/20,this._gridSettings.minorOpacity),this._labelGridRowsCols(),this.show())},t.prototype._drawLines=function(t,e){for(var i=this._gridBounds.lngLo;i<this._gridBounds.lngHi;i+=t){var s=new google.maps.Polyline({path:[{lat:this._gridBounds.latLo,lng:i},{lat:this._gridBounds.latHi,lng:i}],strokeColor:this._gridSettings.gridColor,strokeWeight:1,strokeOpacity:e,clickable:!1,map:this.getMap()});this._gridLines.push(s)}for(var a=this._gridBounds.latLo;a<this._gridBounds.latHi;a+=t){var s=new google.maps.Polyline({path:[{lat:a,lng:-180},{lat:a,lng:0},{lat:a,lng:180}],strokeColor:this._gridSettings.gridColor,strokeWeight:1,strokeOpacity:e,clickable:!1,map:this.getMap()});this._gridLines.push(s)}},t.prototype._labelOLCCells=function(){for(var t=this._gridBounds.latLo;t<=this._gridBounds.latHi;t+=this._majorGridSizeDeg)for(var e=this._gridBounds.lngLo;e<=this._gridBounds.lngHi;e+=this._majorGridSizeDeg){var i=OpenLocationCode.encode(t+this._majorGridSizeDeg/2,e+this._majorGridSizeDeg/2),s={};20==this._majorGridSizeDeg?s.mainlabel=i.substr(0,2):1==this._majorGridSizeDeg?s.mainlabel=i.substr(0,4):.05==this._majorGridSizeDeg?(s.mainlabel=i.substr(4,2),s.title=i.substr(0,4)):(s.mainlabel=i.substr(4,5),s.title=i.substr(0,4)),this._makeLabel(s,t,e,this._majorGridSizeDeg,this._gridSettings.labelClass,this._labelFontSizes.cellLabelMinFontPx,this._labelFontSizes.cellLabelMaxFontPx)}},t.prototype._labelGridRowsCols=function(){for(var t=this.getMap().getBounds(),e=t.getSouthWest().lng(),i=t.getNorthEast().lng()-this._majorGridSizeDeg/20,s=t.getSouthWest().lat(),a=t.getNorthEast().lat()-this._majorGridSizeDeg/20,o=0,r=this._gridBounds.latLo;r<=this._gridBounds.latHi;r+=this._majorGridSizeDeg/20,o++)Math.abs(r-s)<this._majorGridSizeDeg/20/2||Math.abs(r-a)<this._majorGridSizeDeg/20/2||(this._labelGrid(this._olcAlphabet[o%20],r,e),this._labelGrid(this._olcAlphabet[o%20],r,i));o=0;for(var l=this._gridBounds.lngLo;l<=this._gridBounds.lngHi;l+=this._majorGridSizeDeg/20,o++)Math.abs(l-e)<this._majorGridSizeDeg/20/2||Math.abs(l-i)<this._majorGridSizeDeg/20/2||(this._labelGrid(this._olcAlphabet[o%20],s,l),this._labelGrid(this._olcAlphabet[o%20],a,l))},t.prototype._labelGrid=function(t,e,i){this._makeLabel({mainlabel:t},e,i,this._majorGridSizeDeg/20,this._gridSettings.labelClass,this._labelFontSizes.gridLabelMinFontPx,this._labelFontSizes.gridLabelMaxFontPx)},t.prototype._makeLabel=function(t,e,i,s,a,o,r){var l=this._llToPixels(e,i),n=this._llToPixels(e+s,i+s),h=Math.abs(n.y-l.y),d=Math.abs(n.x-l.x),g=l.x,_=l.y-h,p=document.createElement("DIV");p.className=a,p.style.left=g+"px",p.style.top=_+"px",p.style.width=d+"px",p.style.height=h+"px";var m="";if("string"==typeof t.title){var c=Math.min(Math.round(t.mainlabel.length/t.title.length*100),75);m+='<span style="font-size: '+c+'%;">'+t.title+"<br/></span>"}"string"==typeof t.mainlabel&&(m+="<span>"+t.mainlabel+"</span>"),p.innerHTML=m;var u=Math.min(Math.max(d/t.mainlabel.length,o),r);p.style.fontSize=u+"px",this._addToMarkerLayer(p)},t.prototype._llToPixels=function(t,e){return this.getProjection().fromLatLngToDivPixel(new google.maps.LatLng({lat:t,lng:e}))},t.prototype._addToMarkerLayer=function(t){var e=this.getPanes();e.markerLayer.appendChild(t)},t.prototype._clearMarkerLayer=function(){for(var t=this.getPanes();t.markerLayer.firstChild;)t.markerLayer.removeChild(t.markerLayer.firstChild)},t});
